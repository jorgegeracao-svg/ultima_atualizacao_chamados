<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Chamados ‚Äî Gest√£o de Manuten√ß√£o</title>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,400&family=Space+Grotesk:wght@400;500;600;700&display=swap"
    rel="stylesheet">
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #0d0d0d;
      --bg1: #111111;
      --bg2: #1a1a1a;
      --border: #1e1e1e;
      --border2: #2a2a2a;
      --text: #e0e0e0;
      --muted: #555;
      --muted2: #888;
      --accent: #5c6bc0;
      --accent-l: #7f7fcf;
      --green: #4caf50;
      --red: #ef5350;
      --yellow: #ffa726;
      --mono: 'DM Mono', 'Courier New', monospace;
      --sans: 'Space Grotesk', sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--mono);
      min-height: 100vh;
      font-size: 14px;
      line-height: 1.5;
    }

    /* ‚îÄ‚îÄ NOTIFICA√á√ÉO ‚îÄ‚îÄ */
    #notif {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 9999;
      padding: 12px 20px;
      border-radius: 8px;
      border: 1px solid;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 4px 20px rgba(0, 0, 0, .5);
      transition: opacity .3s, transform .3s;
      display: none;
      align-items: center;
      gap: 8px;
      max-width: 340px;
    }

    #notif.show {
      display: flex;
    }

    #notif.ok {
      background: #1e4d2b;
      border-color: #2d7a47;
      color: #7fcf7f;
    }

    #notif.erro {
      background: #4d1e1e;
      border-color: #7a2d2d;
      color: #cf7f7f;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    #header {
      background: var(--bg1);
      border-bottom: 1px solid var(--border2);
      padding: 14px 28px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-logo {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-icon {
      font-size: 28px;
      color: var(--accent);
    }

    .logo-title {
      font-weight: 700;
      font-size: 15px;
      letter-spacing: 2px;
      color: var(--text);
    }

    .logo-sub {
      font-size: 11px;
      color: var(--muted);
      letter-spacing: 1px;
    }

    .header-user {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .user-info {
      text-align: right;
    }

    .user-name {
      font-weight: 700;
      font-size: 14px;
      color: var(--text);
    }

    .user-cats {
      display: flex;
      gap: 6px;
      justify-content: flex-end;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 20px;
    }

    /* ‚îÄ‚îÄ TELAS ‚îÄ‚îÄ */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
    #screen-login {
      min-height: 100vh;
      background: var(--bg);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    #screen-login.active {
      display: flex;
    }

    .login-box {
      background: var(--bg1);
      border: 1px solid var(--border2);
      border-radius: 16px;
      padding: 40px 36px;
      max-width: 700px;
      width: 100%;
      text-align: center;
    }

    .login-icon {
      font-size: 48px;
      margin-bottom: 12px;
      color: var(--accent);
    }

    .login-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 8px;
      font-family: var(--sans);
    }

    .login-sub {
      color: var(--muted);
      font-size: 13px;
      letter-spacing: 1px;
      margin-bottom: 28px;
    }

    .login-instr {
      color: #777;
      font-size: 13px;
      margin-bottom: 16px;
    }

    .login-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
    }

    .login-card {
      background: var(--bg);
      border: 1px solid var(--border2);
      border-radius: 12px;
      padding: 18px 12px;
      cursor: pointer;
      transition: border-color .2s, transform .15s, box-shadow .2s;
      color: var(--text);
      font-family: var(--mono);
    }

    .login-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(92, 107, 192, .2);
    }

    .login-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #1e1e2e;
      border: 2px solid var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      color: var(--accent);
      margin: 0 auto 10px;
    }

    .login-name {
      font-weight: 600;
      font-size: 13px;
      color: var(--text);
    }

    .login-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: center;
      margin-top: 6px;
    }

    /* ‚îÄ‚îÄ P√ÅGINA GEN√âRICA ‚îÄ‚îÄ */
    .page-wrap {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .page-header {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .page-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      font-family: var(--sans);
    }

    .page-sub {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }

    /* ‚îÄ‚îÄ BOT√ïES ‚îÄ‚îÄ */
    .btn-sair {
      background: var(--bg2);
      border: 1px solid #333;
      color: var(--muted2);
      padding: 6px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-family: var(--mono);
      transition: border-color .2s, color .2s;
    }

    .btn-sair:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .btn-voltar {
      background: none;
      border: 1px solid #333;
      color: var(--muted2);
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-family: var(--mono);
      transition: border-color .2s;
      white-space: nowrap;
    }

    .btn-voltar:hover {
      border-color: var(--accent);
      color: var(--text);
    }

    .btn-primary {
      background: var(--accent);
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      letter-spacing: .5px;
      font-family: var(--mono);
      transition: opacity .2s, transform .15s;
    }

    .btn-primary:hover {
      opacity: .88;
      transform: translateY(-1px);
    }

    .btn-primary:disabled {
      opacity: .4;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: var(--bg2);
      border: 1px solid #333;
      color: #aaa;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-family: var(--mono);
      transition: border-color .2s;
    }

    .btn-secondary:hover {
      border-color: var(--muted);
    }

    /* ‚îÄ‚îÄ FILTROS ‚îÄ‚îÄ */
    .filtro-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .filtro-btn {
      background: var(--bg2);
      border: 1px solid #2a2a2a;
      color: #666;
      padding: 7px 14px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      font-family: var(--mono);
      transition: all .2s;
    }

    .filtro-btn:hover {
      border-color: var(--accent);
      color: var(--accent-l);
    }

    .filtro-btn.active {
      background: #1e1e2e;
      border-color: var(--accent);
      color: var(--accent-l);
    }

    /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 16px;
    }

    .card {
      background: var(--bg1);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      cursor: pointer;
      transition: border-color .2s, box-shadow .2s, transform .15s;
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, .4);
    }

    .card.destaque {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(92, 107, 192, .18), 0 4px 20px rgba(92, 107, 192, .15);
    }

    .card.encerrado {
      opacity: .7;
      border-color: #1e2e1e;
    }

    .card-badge {
      position: absolute;
      top: 0;
      right: 0;
      background: var(--accent);
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 0 12px 0 8px;
    }

    .card-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .card-id {
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: 1px;
    }

    .card-title {
      font-weight: 700;
      font-size: 15px;
      color: var(--text);
      margin-bottom: 10px;
      line-height: 1.4;
      font-family: var(--sans);
    }

    .card-meta {
      display: flex;
      gap: 14px;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .card-step {
      background: var(--bg2);
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 10px;
    }

    .card-step-num {
      font-size: 11px;
      color: var(--accent);
      font-weight: 700;
      letter-spacing: 1px;
    }

    .card-step-name {
      font-size: 13px;
      color: #aaa;
      margin-top: 2px;
    }

    /* ‚îÄ‚îÄ STATUS TAG ‚îÄ‚îÄ */
    .status-tag {
      font-size: 11px;
      font-weight: 700;
      padding: 3px 10px;
      border-radius: 12px;
      letter-spacing: .5px;
      white-space: nowrap;
    }

    .status-open {
      background: #1e2a3a;
      color: #5c9bc0;
    }

    .status-done {
      background: #1e2e1e;
      color: #5cb05c;
    }

    /* ‚îÄ‚îÄ PROGRESSO ‚îÄ‚îÄ */
    .progress-wrap {
      height: 4px;
      background: var(--bg2);
      border-radius: 2px;
      margin-top: 10px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      border-radius: 2px;
      transition: width .4s ease;
    }

    .vazio {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .vazio-icon {
      font-size: 48px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .vazio-msg {
      color: var(--muted2);
    }

    /* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
    .form-box {
      background: var(--bg1);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      max-width: 700px;
    }

    label.lbl {
      display: block;
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
      letter-spacing: .5px;
      font-weight: 600;
    }

    input.inp,
    textarea.inp {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 14px;
      margin-bottom: 16px;
      outline: none;
      font-family: var(--mono);
      transition: border-color .2s;
    }

    input.inp:focus,
    textarea.inp:focus {
      border-color: var(--accent);
    }

    textarea.inp {
      resize: vertical;
    }

    .etapa-banner {
      background: #1e1e2e;
      border: 1px solid #2a2a3e;
      border-radius: 8px;
      padding: 10px 14px;
      margin-bottom: 20px;
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .etapa-num-big {
      font-size: 11px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 1px;
    }

    .etapa-nome-big {
      font-size: 14px;
      color: #9fa8da;
    }

    /* ‚îÄ‚îÄ BARRA ETAPAS ‚îÄ‚îÄ */
    .steps-bar {
      display: flex;
      overflow-x: auto;
      gap: 0;
      background: var(--bg1);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px;
      scrollbar-width: thin;
      scrollbar-color: var(--border2) transparent;
    }

    .steps-bar::-webkit-scrollbar {
      height: 4px;
    }

    .steps-bar::-webkit-scrollbar-track {
      background: transparent;
    }

    .steps-bar::-webkit-scrollbar-thumb {
      background: var(--border2);
      border-radius: 2px;
    }

    .step-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 80px;
      padding: 0 8px;
      text-align: center;
      gap: 4px;
    }

    .step-circle {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: var(--bg);
    }

    .step-label {
      font-size: 10px;
      line-height: 1.3;
    }

    .step-item.past .step-circle {
      background: var(--green);
    }

    .step-item.past .step-label {
      color: var(--green);
    }

    .step-item.current .step-circle {
      background: var(--accent-l);
    }

    .step-item.current .step-label {
      color: var(--accent-l);
    }

    .step-item.future .step-circle {
      background: #333;
    }

    .step-item.future .step-label {
      color: #333;
    }

    /* ‚îÄ‚îÄ ETAPA ATUAL BOX ‚îÄ‚îÄ */
    .current-step-box {
      background: var(--bg1);
      border: 1px solid #2a2a3e;
      border-radius: 12px;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .current-step-num {
      font-weight: 700;
      font-size: 15px;
      color: #9fa8da;
      font-family: var(--sans);
    }

    .current-step-desc {
      color: #666;
      font-size: 13px;
      margin-top: 4px;
    }

    .btn-atender {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 12px 22px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
      font-family: var(--mono);
      transition: opacity .2s, transform .15s;
    }

    .btn-atender:hover {
      opacity: .88;
      transform: translateY(-1px);
    }

    .sem-permissao {
      font-size: 12px;
      color: var(--muted);
      padding: 10px 14px;
      background: var(--bg2);
      border-radius: 8px;
      border: 1px solid var(--border2);
    }

    /* ‚îÄ‚îÄ FORM ATENDER ‚îÄ‚îÄ */
    .form-atender {
      background: var(--bg1);
      border: 1px solid #2a2a3e;
      border-radius: 12px;
      padding: 24px;
    }

    .form-atender h3 {
      color: var(--text);
      margin-bottom: 16px;
      font-size: 15px;
      font-family: var(--sans);
    }

    .btn-opcao {
      flex: 1;
      background: var(--bg2);
      border: 1px solid #333;
      color: var(--muted2);
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      font-family: var(--mono);
      transition: all .2s;
    }

    .btn-opcao:hover {
      border-color: var(--muted);
    }

    .btn-opcao.ativo-verde {
      background: #1a2a1a;
      border-color: var(--green);
      color: #7fcf7f;
    }

    .btn-opcao.ativo-vermelho {
      background: #2a1a1a;
      border-color: var(--red);
      color: #cf7f7f;
    }

    .stock-hint {
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted2);
    }

    /* ‚îÄ‚îÄ ESTRELAS ‚îÄ‚îÄ */
    .estrela-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 28px;
      transition: transform .15s;
      padding: 2px;
    }

    .estrela-btn:hover {
      transform: scale(1.2);
    }

    /* ‚îÄ‚îÄ HIST√ìRICO ‚îÄ‚îÄ */
    .historico-wrap {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .historico-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--muted2);
      letter-spacing: 1px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
      font-family: var(--sans);
    }

    .msg-card {
      background: var(--bg1);
      border: 1px solid var(--border);
      border-left: 3px solid var(--accent);
      border-radius: 10px;
      padding: 16px 18px;
      animation: fadeIn .3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(6px);
      }

      to {
        opacity: 1;
        transform: none;
      }
    }

    .msg-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .msg-num {
      font-size: 12px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 1px;
    }

    .msg-etapa {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .msg-meta {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .msg-texto {
      font-size: 14px;
      color: #ccc;
      line-height: 1.6;
    }

    .msg-anexo {
      margin-top: 10px;
      padding: 6px 10px;
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: 6px;
      font-size: 12px;
      color: var(--accent-l);
      display: inline-block;
    }

    .avaliacao-final {
      background: var(--bg1);
      border: 1px solid #1e2e1e;
      border-radius: 10px;
      padding: 16px 18px;
      text-align: center;
    }

    /* ‚îÄ‚îÄ TAG CATEGORIA ‚îÄ‚îÄ */
    .tag-cat {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: 600;
      letter-spacing: .3px;
      white-space: nowrap;
    }

    /* ‚îÄ‚îÄ ANEXO ‚îÄ‚îÄ */
    .anexo-wrap {
      margin-bottom: 16px;
    }

    .btn-anexo {
      background: var(--bg2);
      border: 1px dashed #333;
      color: #666;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-family: var(--mono);
      transition: border-color .2s, color .2s;
    }

    .btn-anexo:hover {
      border-color: var(--accent);
      color: var(--accent-l);
    }

    .anexo-ativo {
      background: #1a1a2a;
      border: 1px solid #2a2a3e;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 13px;
      color: var(--accent-l);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-remover-anexo {
      background: none;
      border: none;
      color: var(--red);
      cursor: pointer;
      font-size: 16px;
      line-height: 1;
      padding: 0 2px;
      transition: opacity .2s;
    }

    .btn-remover-anexo:hover {
      opacity: .7;
    }

    /* ‚îÄ‚îÄ CHAMADO INFO ‚îÄ‚îÄ */
    .chamado-info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .chamado-meta-row {
      display: flex;
      gap: 14px;
      font-size: 12px;
      color: var(--muted);
      flex-wrap: wrap;
    }

    .step-item.sub .step-circle {
      width: 24px;
      height: 24px;
      font-size: 10px;
      border: 1px dashed currentColor;
      background: transparent !important;
      color: inherit;
    }

    .step-item.sub.past .step-circle {
      background: transparent !important;
      color: var(--green);
      border-color: var(--green);
    }

    .step-item.sub.current .step-circle {
      background: transparent !important;
      color: var(--accent-l);
      border-color: var(--accent-l);
    }

    .step-item.sub.future .step-circle {
      background: transparent !important;
      color: #333;
      border-color: #333;
    }

    .step-item.sub .step-circle {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .step-item.sub {
      min-width: 68px;
    }

    /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .7);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .modal-box {
      background: var(--bg1);
      border: 1px solid var(--border2);
      border-radius: 16px;
      padding: 28px;
      width: 100%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .6);
    }

    .modal-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 6px;
      font-family: var(--sans);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-sub {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 20px;
    }

    select.inp {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: 10px 12px;
      color: var(--text);
      font-size: 14px;
      margin-bottom: 16px;
      outline: none;
      font-family: var(--mono);
      transition: border-color .2s;
      cursor: pointer;
      appearance: none;
    }

    select.inp:focus {
      border-color: var(--accent);
    }

    .btn-danger {
      background: #4d1e1e;
      border: 1px solid var(--red);
      color: #cf7f7f;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      font-family: var(--mono);
      transition: opacity .2s;
    }

    .btn-danger:hover {
      opacity: .85;
    }

    @media (max-width: 600px) {
      #header {
        padding: 12px 16px;
      }

      main {
        padding: 16px 12px;
      }

      .login-box {
        padding: 28px 20px;
      }

      .form-box {
        padding: 16px;
      }

      .form-atender {
        padding: 16px;
      }

      .current-step-box {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>

<body>

  <!-- NOTIFICA√á√ÉO -->
  <div id="notif"></div>

  <!-- HEADER (oculto na tela de login) -->
  <div id="header" style="display:none">
    <div class="header-logo">
      <div class="logo-icon">‚öô</div>
      <div>
        <div class="logo-title">SISTEMA DE CHAMADOS</div>
        <div class="logo-sub">Gest√£o de Manuten√ß√£o</div>
      </div>
    </div>
    <div class="header-user">
      <div class="user-info">
        <div class="user-name" id="header-nome"></div>
        <div class="user-cats" id="header-cats"></div>
      </div>
      <button class="btn-sair" onclick="fazerLogout()">Sair</button>
    </div>
  </div>

  <!-- TELA LOGIN -->
  <div id="screen-login" class="screen active">
    <div class="login-box">
      <div class="login-icon">‚öô</div>
      <h1 class="login-title">Sistema de Chamados</h1>
      <p class="login-sub">Gest√£o de Manuten√ß√£o por C√©lulas</p>
      <p class="login-instr">Selecione seu perfil para entrar:</p>
      <div class="login-grid" id="login-grid"></div>
    </div>
  </div>

  <!-- MAIN (telas internas) -->
  <main id="main-area" style="display:none">

    <!-- TELA LISTA -->
    <div id="screen-lista" class="screen">
      <div class="page-wrap">
        <div class="page-header">
          <div>
            <h2 class="page-title">Central de Chamados</h2>
            <p class="page-sub" id="lista-sub">0 chamado(s) registrado(s)</p>
          </div>
          <button class="btn-primary" onclick="irParaNovo()">+ Novo Chamado</button>
        </div>
        <div class="filtro-row" id="filtro-row">
          <button class="filtro-btn active" data-filtro="todos" onclick="setFiltro(this,'todos')">Todos</button>
          <button class="filtro-btn" data-filtro="meus" onclick="setFiltro(this,'meus')">Aguardando minha a√ß√£o</button>
          <button class="filtro-btn" data-filtro="encerrados" onclick="setFiltro(this,'encerrados')">Encerrados</button>
        </div>
        <div id="cards-container"></div>
      </div>
    </div>

    <!-- TELA NOVO CHAMADO -->
    <div id="screen-novo" class="screen">
      <div class="page-wrap">
        <div class="page-header">
          <button class="btn-voltar" onclick="irParaLista()">‚Üê Voltar</button>
          <h2 class="page-title">Novo Chamado</h2>
        </div>
        <div class="form-box">
          <div class="etapa-banner">
            <span class="etapa-num-big">Etapa 1</span>
            <span class="etapa-nome-big">Abertura do Chamado</span>
          </div>
          <label class="lbl">T√≠tulo do Chamado *</label>
          <input class="inp" type="text" id="novo-titulo" placeholder="Ex: Ar-condicionado sala 3 n√£o funciona"
            oninput="validarNovo()">
          <label class="lbl">Descri√ß√£o do Problema *</label>
          <textarea class="inp" id="novo-desc" rows="5" placeholder="Descreva detalhadamente o problema observado..."
            oninput="validarNovo()"></textarea>
          <label class="lbl">Anexar Imagem (opcional)</label>
          <div id="novo-anexo-wrap" class="anexo-wrap"></div>
          <div style="display:flex;gap:12px;margin-top:24px">
            <button class="btn-secondary" onclick="irParaLista()">Cancelar</button>
            <button class="btn-primary" id="btn-enviar" onclick="criarChamado()" disabled>Enviar Chamado</button>
          </div>
        </div>
      </div>
    </div>

    <!-- TELA CHAMADO -->
    <div id="screen-chamado" class="screen">
      <div class="page-wrap">
        <div class="page-header">
          <button class="btn-voltar" onclick="irParaLista()">‚Üê Voltar</button>
          <div>
            <h2 class="page-title" id="chamado-titulo-hdr"></h2>
            <p class="page-sub" id="chamado-sub-hdr"></p>
          </div>
          <span id="chamado-status-tag" class="status-tag" style="align-self:center"></span>
        </div>
        <div id="chamado-steps-bar" class="steps-bar"></div>
        <div id="chamado-current-box"></div>
        <div id="chamado-form-atender"></div>
        <div class="historico-wrap">
          <h3 class="historico-title">Hist√≥rico do Chamado</h3>
          <div id="chamado-historico"></div>
        </div>
      </div>
    </div>

  </main>

  <!-- MODAL VOLTAR ETAPA -->
  <div id="modal-voltar" style="display:none">
    <div class="modal-overlay" onclick="fecharModalVoltar(event)">
      <div class="modal-box" onclick="event.stopPropagation()">
        <div class="modal-title">‚Ü© Voltar Etapa</div>
        <div class="modal-sub" id="modal-voltar-sub"></div>
        <label class="lbl">Motivo da Devolu√ß√£o *</label>
        <select class="inp" id="modal-motivo-select" onchange="syncMotivoSelect()">
          <option value="">‚Äî Selecione um motivo ‚Äî</option>
          <option>Informa√ß√µes insuficientes</option>
          <option>Erro no diagn√≥stico</option>
          <option>Or√ßamento incorreto ou incompleto</option>
          <option>Material recebido com defeito ou divergente</option>
          <option>Servi√ßo executado incorretamente</option>
          <option>Documento / anexo faltando</option>
          <option>Solicita√ß√£o de revis√£o pelo gestor</option>
          <option>Outro</option>
        </select>
        <label class="lbl">Observa√ß√£o *</label>
        <textarea class="inp" id="modal-obs" rows="4"
          placeholder="Descreva o motivo detalhado da devolu√ß√£o..."></textarea>
        <div style="display:flex;gap:12px;margin-top:8px">
          <button class="btn-secondary" onclick="fecharModalVoltar()">Cancelar</button>
          <button class="btn-danger" onclick="confirmarVoltarEtapa()">‚Ü© Confirmar Devolu√ß√£o</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚îÄ‚îÄ DADOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    const USUARIOS = [
      { id: 1, nome: "Ana Souza", categorias: ["Solicitante"] },
      { id: 2, nome: "Bruno Lima", categorias: ["Solicitante", "Administra√ß√£o de Manuten√ß√£o"] },
      { id: 3, nome: "Carla Mendes", categorias: ["Solicitante", "T√©cnico de Manuten√ß√£o"] },
      { id: 4, nome: "Diego Santos", categorias: ["Solicitante", "Comprador"] },
      { id: 5, nome: "Eva Rodrigues", categorias: ["Solicitante", "Gestor"] },
      { id: 6, nome: "Felipe Costa", categorias: ["Solicitante", "T√©cnico de Manuten√ß√£o"] },
    ];

    const ETAPAS = {
      1: { nome: "Abertura do Chamado", responsavel: "Solicitante", descricao: "Descri√ß√£o do problema pelo solicitante", grupo: null },
      2: { nome: "Agendamento da Avalia√ß√£o", responsavel: "Administra√ß√£o de Manuten√ß√£o", descricao: "Agendamento da visita t√©cnica", grupo: null },
      3: { nome: "Avalia√ß√£o T√©cnica", responsavel: "T√©cnico de Manuten√ß√£o", descricao: "Diagn√≥stico do problema", grupo: null },
      4: { nome: "Verifica√ß√£o de Estoque", responsavel: "T√©cnico de Manuten√ß√£o", descricao: "Verifica√ß√£o de disponibilidade de material", grupo: null },
      "5.1": { nome: "Cota√ß√£o", responsavel: "Comprador", descricao: "Informar data prevista e enviar os 3 or√ßamentos", grupo: 5, subIdx: 1 },
      "5.2": { nome: "Envio do Or√ßamento", responsavel: "Comprador", descricao: "Enviar os 3 or√ßamentos obtidos para aprova√ß√£o", grupo: 5, subIdx: 2 },
      "5.3": { nome: "Aprova√ß√£o do Gestor", responsavel: "Gestor", descricao: "Aprovar ou reprovar os or√ßamentos ‚Äî reprova√ß√£o retorna √† Cota√ß√£o", grupo: 5, subIdx: 3 },
      "5.4": { nome: "Programar Entrega", responsavel: "Comprador", descricao: "Informar a data prevista de chegada da mercadoria", grupo: 5, subIdx: 4 },
      6: { nome: "Recebimento de Mercadoria", responsavel: "Administra√ß√£o de Manuten√ß√£o", descricao: "Confirma√ß√£o do recebimento e nota fiscal", grupo: null },
      7: { nome: "Programa√ß√£o do Servi√ßo", responsavel: "T√©cnico de Manuten√ß√£o", descricao: "Agendamento da execu√ß√£o", grupo: null },
      8: { nome: "Execu√ß√£o da Manuten√ß√£o", responsavel: "T√©cnico de Manuten√ß√£o", descricao: "Realiza√ß√£o e registro do servi√ßo (foto obrigat√≥ria)", grupo: null },
      9: { nome: "Finaliza√ß√£o do Chamado", responsavel: "Solicitante", descricao: "Avalia√ß√£o e encerramento", grupo: null },
    };

    // Ordem can√¥nica das etapas para a barra de progresso
    const ETAPAS_ORDEM = [1, 2, 3, 4, "5.1", "5.2", "5.3", "5.4", 6, 7, 8, 9];

    const CORES = {
      "Solicitante": { tag: "#2d5a2d", text: "#7fcf7f", dot: "#4caf50" },
      "Administra√ß√£o de Manuten√ß√£o": { tag: "#2d2d5a", text: "#7f7fcf", dot: "#5c6bc0" },
      "T√©cnico de Manuten√ß√£o": { tag: "#5a2d2d", text: "#cf7f7f", dot: "#ef5350" },
      "Comprador": { tag: "#2d5a5a", text: "#7fcfcf", dot: "#26c6da" },
      "Gestor": { tag: "#5a5a2d", text: "#cfcf7f", dot: "#ffa726" },
    };

    const NOMES_ANEXO = [
      "foto_problema.jpg", "diagnostico.pdf", "nota_fiscal.pdf",
      "orcamento.pdf", "foto_servico.jpg", "comprovante.pdf",
    ];

    // ‚îÄ‚îÄ ESTADO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    let usuarioAtual = null;
    let chamados = [];
    let chamadoAberto = null;
    let filtroAtual = "todos";
    let novoAnexo = null;
    let atenderObs = "";
    let atenderAnexo = null;
    let atenderMaterial = null;
    let atenderAprovacao = null;
    let atenderAvaliacao = 0;
    let modoAtender = false;

    // ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function gerarId() {
      const ano = new Date().getFullYear();
      const seq = String(chamados.length + 1).padStart(4, "0");
      return Number(`${ano}${seq}`);
    }

    function dataAgora() {
      return new Date().toLocaleString("pt-BR", {
        day: "2-digit", month: "2-digit", year: "numeric", hour: "2-digit", minute: "2-digit"
      });
    }

    function mostrarNotif(msg, tipo = "ok") {
      const el = document.getElementById("notif");
      el.className = "show " + tipo;
      el.innerHTML = `<span>${tipo === "ok" ? "‚úì" : "‚úï"}</span> ${msg}`;
      clearTimeout(window._notifTimer);
      window._notifTimer = setTimeout(() => { el.className = ""; }, 3200);
    }

    function tagCat(cat, extra = "") {
      const c = CORES[cat] || { tag: "#333", text: "#ccc" };
      return `<span class="tag-cat${extra}" style="background:${c.tag};color:${c.text}">${cat}</span>`;
    }

    function barraProgresso(etapa, encerrado) {
      const total = ETAPAS_ORDEM.length;
      const idx = ETAPAS_ORDEM.indexOf(etapa);
      const atual = encerrado ? total : Math.max(0, idx);
      const pct = (atual / total) * 100;
      const cor = encerrado ? "#4caf50" : "#5c6bc0";
      return `<div class="progress-wrap"><div class="progress-bar" style="width:${pct}%;background:${cor}"></div></div>`;
    }

    function estrelas(n) {
      return "‚òÖ".repeat(n) + "‚òÜ".repeat(5 - n);
    }

    // ‚îÄ‚îÄ NAVEGA√á√ÉO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function mostrarTela(id) {
      document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
      document.getElementById("screen-" + id).classList.add("active");
    }

    function irParaLogin() {
      document.getElementById("header").style.display = "none";
      document.getElementById("main-area").style.display = "none";
      mostrarTela("login");
    }

    function irParaLista() {
      renderLista();
      mostrarTela("lista");
    }

    function irParaNovo() {
      novoAnexo = null;
      document.getElementById("novo-titulo").value = "";
      document.getElementById("novo-desc").value = "";
      renderAnexo("novo-anexo-wrap", novoAnexo, val => { novoAnexo = val; });
      validarNovo();
      mostrarTela("novo");
    }

    function fazerLogout() {
      usuarioAtual = null;
      chamadoAberto = null;
      document.getElementById("header").style.display = "none";
      document.getElementById("main-area").style.display = "none";
      mostrarTela("login");
    }

    // ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function renderLogin() {
      const grid = document.getElementById("login-grid");
      grid.innerHTML = USUARIOS.map(u => {
        const inicial = u.nome.charAt(0);
        const tags = u.categorias.map(c => tagCat(c)).join("");
        return `
      <button class="login-card" onclick="loginComo(${u.id})">
        <div class="login-avatar">${inicial}</div>
        <div class="login-name">${u.nome}</div>
        <div class="login-tags">${tags}</div>
      </button>`;
      }).join("");
    }

    function loginComo(id) {
      usuarioAtual = USUARIOS.find(u => u.id === id);
      document.getElementById("header-nome").textContent = usuarioAtual.nome;

      const cats = document.getElementById("header-cats");
      cats.innerHTML = usuarioAtual.categorias
        .filter(c => c !== "Solicitante")
        .map(c => tagCat(c))
        .join("") + tagCat("Solicitante");

      document.getElementById("header").style.display = "flex";
      document.getElementById("main-area").style.display = "block";
      irParaLista();
    }

    // ‚îÄ‚îÄ LISTA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function meusEtapasFn() {
      return Object.keys(ETAPAS)
        .filter(k => usuarioAtual.categorias.includes(ETAPAS[k].responsavel))
        .map(k => isNaN(k) ? k : Number(k));
    }

    function setFiltro(btn, valor) {
      filtroAtual = valor;
      document.querySelectorAll(".filtro-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderCards();
    }

    function renderLista() {
      document.getElementById("lista-sub").textContent = `${chamados.length} chamado(s) registrado(s)`;
      renderCards();
    }

    function renderCards() {
      const container = document.getElementById("cards-container");
      const meusEtapas = meusEtapasFn();

      const filtrados = chamados.filter(c => {
        if (filtroAtual === "meus") {
          if (c.status === "encerrado") return false;
          if (!meusEtapas.some(e => String(e) === String(c.etapaAtual))) return false;
          if (c.etapaAtual === 9 && c.solicitante.id !== usuarioAtual.id) return false;
          return true;
        }
        if (filtroAtual === "encerrados") return c.status === "encerrado";
        return true;
      });

      if (filtrados.length === 0) {
        container.innerHTML = `<div class="vazio"><div class="vazio-icon">üìã</div><div class="vazio-msg">Nenhum chamado encontrado</div></div>`;
        return;
      }

      const html = filtrados.map(c => {
        const etapa = ETAPAS[c.etapaAtual];
        const minhaVez = meusEtapas.includes(c.etapaAtual) && c.status !== "encerrado";
        const enc = c.status === "encerrado";
        const badge = "";
        const statusCls = enc ? "status-done" : "status-open";
        const statusTxt = enc ? "Encerrado" : "Em andamento";
        const stepBox = !enc ? `<div class="card-step"><div class="card-step-num">Etapa ${c.etapaAtual}</div><div class="card-step-name">${etapa?.nome}</div></div>` : "";
        const avBox = (enc && c.avaliacao) ? `<div style="margin-top:8px;color:#ffa726;font-size:14px">${estrelas(c.avaliacao)}</div>` : "";
        return `
      <div class="card${minhaVez ? " destaque" : ""}${enc ? " encerrado" : ""}" onclick="abrirChamado(${c.id})">
        ${badge}
        <div class="card-top">
          <span class="card-id">#${c.id}</span>
          <span class="status-tag ${statusCls}">${statusTxt}</span>
        </div>
        <div class="card-title">${c.titulo}</div>
        <div class="card-meta">
          <span>üë§ ${c.solicitante.nome}</span>
          <span>üïê ${c.criadoEm}</span>
        </div>
        ${stepBox}${avBox}
        ${barraProgresso(c.etapaAtual, enc)}
      </div>`;
      }).join("");

      container.innerHTML = `<div class="cards-grid">${html}</div>`;
    }

    // ‚îÄ‚îÄ NOVO CHAMADO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function validarNovo() {
      const t = document.getElementById("novo-titulo").value.trim();
      const d = document.getElementById("novo-desc").value.trim();
      document.getElementById("btn-enviar").disabled = !(t && d);
    }

    function criarChamado() {
      const titulo = document.getElementById("novo-titulo").value.trim();
      const descricao = document.getElementById("novo-desc").value.trim();
      if (!titulo || !descricao) return;

      const novo = {
        id: gerarId(),
        titulo,
        etapaAtual: 2,
        status: "aberto",
        criadoEm: dataAgora(),
        solicitante: usuarioAtual,
        mensagens: [{
          num: 1,
          etapa: 1,
          nomeEtapa: ETAPAS[1].nome,
          usuario: usuarioAtual.nome,
          categoria: "Solicitante",
          data: dataAgora(),
          texto: descricao,
          anexo: novoAnexo || null,
        }],
        avaliacao: null,
      };

      chamados.unshift(novo);
      mostrarNotif(`Chamado #${novo.id} aberto com sucesso!`);
      irParaLista();
    }

    // ‚îÄ‚îÄ CHAMADO ABERTO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function abrirChamado(id) {
      chamadoAberto = chamados.find(c => c.id === id);
      modoAtender = false;
      atenderObs = "";
      atenderAnexo = null;
      atenderMaterial = null;
      atenderAprovacao = null;
      atenderAvaliacao = 0;
      renderChamado();
      mostrarTela("chamado");
    }

    function renderChamado() {
      if (!chamadoAberto) return;
      const c = chamadoAberto;
      const etapaAtual = c.etapaAtual;
      const etapaInfo = ETAPAS[etapaAtual];
      const enc = c.status === "encerrado";

      // Verifica se o usu√°rio tem permiss√£o para atender a etapa atual
      const podeAtender = !enc
        && usuarioAtual.categorias.includes(etapaInfo?.responsavel)
        && (etapaAtual !== 9 || chamadoAberto.solicitante.id === usuarioAtual.id);

      // header
      document.getElementById("chamado-titulo-hdr").textContent = `Chamado #${c.id}`;
      document.getElementById("chamado-sub-hdr").textContent = c.titulo;
      const stTag = document.getElementById("chamado-status-tag");
      stTag.className = "status-tag " + (enc ? "status-done" : "status-open");
      stTag.textContent = enc ? "Encerrado" : "Em andamento";

      // barra de etapas
      const bar = document.getElementById("chamado-steps-bar");
      bar.innerHTML = ETAPAS_ORDEM.map(key => {
        const e = ETAPAS[key];
        const idxAtual = ETAPAS_ORDEM.indexOf(c.etapaAtual);
        const idxItem = ETAPAS_ORDEM.indexOf(key);
        const passada = enc ? true : idxItem < idxAtual;
        const atual = !enc && String(key) === String(c.etapaAtual);
        const cls = atual ? "current" : passada ? "past" : "future";
        const isSub = e.grupo !== null && e.grupo !== undefined;
        const label = (passada && !atual) ? "‚úì" : String(key);
        return `
      <div class="step-item ${cls}${isSub ? " sub" : ""}">
        <div class="step-circle">${label}</div>
        <div class="step-label">${e.nome}</div>
      </div>`;
      }).join("");

      // box etapa atual
      const box = document.getElementById("chamado-current-box");
      if (!enc) {
        const corResp = CORES[etapaInfo.responsavel]?.dot || "#aaa";

        // ‚îÄ‚îÄ CORRE√á√ÉO: bot√£o "Voltar Etapa" s√≥ aparece para quem pode atender a etapa atual
        const podeVoltar = podeAtender
          && MOTIVOS_VOLTAR[etapaAtual] !== null
          && MOTIVOS_VOLTAR[etapaAtual] !== undefined;

        const btnAtender = podeAtender && !modoAtender
          ? `<button class="btn-atender" onclick="abrirModoAtender()">Atender Chamado</button>`
          : !podeAtender
            ? `<div class="sem-permissao">Sem permiss√£o para atender esta etapa</div>`
            : "";
        const btnVoltar = podeVoltar && !modoAtender
          ? `<button class="btn-secondary" onclick="abrirModalVoltar()" style="border-color:#ef535044;color:#cf7f7f">‚Ü© Voltar Etapa</button>`
          : "";
        box.innerHTML = `
      <div class="current-step-box">
        <div>
          <div class="current-step-num">Etapa ${etapaAtual} ‚Äî ${etapaInfo.nome}</div>
          <div class="current-step-desc">${etapaInfo.descricao}</div>
          <div style="margin-top:6px;font-size:13px;color:#888">
            Respons√°vel: <span style="color:${corResp}">${etapaInfo.responsavel}</span>
          </div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end">
          ${btnVoltar}
          ${btnAtender}
        </div>
      </div>`;
        box.style.display = "";
      } else {
        box.innerHTML = "";
        box.style.display = "none";
      }

      // form atender
      renderFormAtender();

      // hist√≥rico
      renderHistorico();
    }

    function abrirModoAtender() {
      modoAtender = true;
      atenderObs = "";
      atenderAnexo = null;
      atenderMaterial = null;
      atenderAprovacao = null;
      atenderAvaliacao = 0;
      renderChamado();
    }

    function cancelarAtender() {
      modoAtender = false;
      atenderAprovacao = null;
      renderChamado();
    }

    function renderFormAtender() {
      const formEl = document.getElementById("chamado-form-atender");
      if (!modoAtender) { formEl.innerHTML = ""; return; }

      const c = chamadoAberto;
      const etapaAtual = c.etapaAtual;
      const etapaInfo = ETAPAS[etapaAtual];

      const placeholders = {
        2: "Informe a data e hor√°rio agendado para a visita t√©cnica...",
        3: "Descreva o diagn√≥stico t√©cnico do problema...",
        4: "Registre a verifica√ß√£o de estoque...",
        "5.1": "Informe a data prevista para o envio dos or√ßamentos...",
        "5.2": "Descreva os or√ßamentos obtidos e anexe os arquivos...",
        "5.3": "Justifique sua decis√£o de aprova√ß√£o ou reprova√ß√£o...",
        "5.4": "Informe a data prevista de chegada da mercadoria...",
        6: "Confirme o recebimento da mercadoria e registre a nota fiscal...",
        7: "Informe a data programada para execu√ß√£o do servi√ßo...",
        8: "Registre a execu√ß√£o do servi√ßo realizado...",
        9: "Descreva sua experi√™ncia (opcional)...",
      };
      const ph = placeholders[etapaAtual] || "Digite sua observa√ß√£o...";

      // estoque (etapa 4)
      const estoqueHtml = etapaAtual === 4 ? `
    <div style="margin-bottom:16px">
      <label class="lbl">Situa√ß√£o do Estoque *</label>
      <div style="display:flex;gap:12px">
        <button id="btn-mat-sim" class="btn-opcao${atenderMaterial === true ? " ativo-verde" : ""}" onclick="setMaterial(true)">‚úì Material Dispon√≠vel</button>
        <button id="btn-mat-nao" class="btn-opcao${atenderMaterial === false ? " ativo-vermelho" : ""}" onclick="setMaterial(false)">‚úó Sem Material</button>
      </div>
      ${atenderMaterial !== null ? `<div class="stock-hint">${atenderMaterial ? "‚Üí Chamado avan√ßar√° para Etapa 7 (Programa√ß√£o do Servi√ßo)" : "‚Üí Chamado avan√ßar√° para Etapa 5 (Processo de Compras)"}</div>` : ""}
    </div>` : "";

      // avalia√ß√£o (etapa 9)
      const aval = NOTAS_ESTRELAS().map(n => `
    <button class="estrela-btn" onclick="setAvaliacao(${n})"
      style="color:${n <= atenderAvaliacao ? "#ffa726" : "#444"}">
      ${n <= atenderAvaliacao ? "‚òÖ" : "‚òÜ"}
    </button>`).join("");
      const avaliacaoHtml = etapaAtual === 9 ? `
    <div style="margin-bottom:16px">
      <label class="lbl">Avalia√ß√£o do Atendimento *</label>
      <div style="display:flex;gap:8px;margin-top:8px">${aval}</div>
    </div>` : "";

      // aprova√ß√£o gestor (etapa 5.3)
      const aprovacaoHtml = etapaAtual === "5.3" ? `
    <div style="margin-bottom:16px">
      <label class="lbl">Decis√£o do Gestor *</label>
      <div style="display:flex;gap:12px">
        <button class="btn-opcao${atenderAprovacao === true ? " ativo-verde" : ""}" onclick="setAprovacao(true)">‚úì Aprovar Or√ßamento</button>
        <button class="btn-opcao${atenderAprovacao === false ? " ativo-vermelho" : ""}" onclick="setAprovacao(false)">‚úó Reprovar ‚Äî Nova Cota√ß√£o</button>
      </div>
      ${atenderAprovacao !== null ? `<div class="stock-hint">${atenderAprovacao
          ? "‚Üí Chamado avan√ßar√° para Etapa 5.4 (Programar Entrega)"
          : "‚Üí Chamado retornar√° √† Etapa 5.1 (Cota√ß√£o)"}</div>` : ""}
    </div>` : "";

      const anexoLabel = etapaAtual === 8 ? "Foto do Servi√ßo (OBRIGAT√ìRIO) *" : etapaAtual === "5.2" ? "Or√ßamentos (opcional)" : "Anexar Arquivo (opcional)";
      const btnLabel = etapaAtual === 9 ? "Finalizar Chamado"
        : etapaAtual === "5.3" && atenderAprovacao === false ? "Reprovar e Recotizar"
          : "Avan√ßar Chamado ‚Üí";

      formEl.innerHTML = `
    <div class="form-atender">
      <h3>Atendendo ‚Äî Etapa ${etapaAtual}: ${etapaInfo.nome}</h3>
      ${estoqueHtml}
      ${aprovacaoHtml}
      ${avaliacaoHtml}
      <label class="lbl">Observa√ß√£o *</label>
      <textarea class="inp" id="atender-obs" rows="4" placeholder="${ph}" oninput="atenderObs=this.value">${atenderObs}</textarea>
      <label class="lbl">${anexoLabel}</label>
      <div id="atender-anexo-wrap" class="anexo-wrap"></div>
      <div style="display:flex;gap:12px;margin-top:20px">
        <button class="btn-secondary" onclick="cancelarAtender()">Cancelar</button>
        <button class="btn-primary" onclick="avancarChamado()">${btnLabel}</button>
      </div>
    </div>`;

      renderAnexo("atender-anexo-wrap", atenderAnexo, val => {
        atenderAnexo = val;
        renderFormAtender();
      });
    }

    function NOTAS_ESTRELAS() { return [1, 2, 3, 4, 5]; }

    function setMaterial(val) {
      atenderMaterial = val;
      renderFormAtender();
    }

    function setAprovacao(val) {
      atenderAprovacao = val;
      renderFormAtender();
    }

    function setAvaliacao(n) {
      atenderAvaliacao = n;
      renderFormAtender();
    }

    function proximaEtapa(etapaAtual) {
      if (etapaAtual === 4) {
        if (atenderMaterial === null) { mostrarNotif("Informe se h√° material em estoque.", "erro"); return null; }
        return atenderMaterial ? 7 : "5.1";
      }
      if (etapaAtual === "5.3") {
        if (atenderAprovacao === null) { mostrarNotif("Informe se os or√ßamentos foram aprovados.", "erro"); return null; }
        return atenderAprovacao ? "5.4" : "5.1";
      }
      if (etapaAtual === 9) return "encerrar";
      const mapa = { 1: 2, 2: 3, 3: 4, "5.1": "5.2", "5.2": "5.3", "5.4": 6, 6: 7, 7: 8, 8: 9 };
      return mapa[etapaAtual] ?? etapaAtual + 1;
    }

    function validarAvanco(etapaAtual) {
      const obs = document.getElementById("atender-obs")?.value.trim() || atenderObs.trim();
      atenderObs = obs;
      if (etapaAtual === 8 && !atenderAnexo) {
        mostrarNotif("A Etapa 8 exige anexo de foto do servi√ßo realizado!", "erro"); return false;
      }
      if (etapaAtual === 9 && atenderAvaliacao === 0) {
        mostrarNotif("Por favor, avalie o atendimento antes de finalizar.", "erro"); return false;
      }
      if (etapaAtual === "5.3" && atenderAprovacao === null) {
        mostrarNotif("Informe se os or√ßamentos foram aprovados ou reprovados.", "erro"); return false;
      }
      if (!obs) {
        mostrarNotif("O campo de observa√ß√£o √© obrigat√≥rio.", "erro"); return false;
      }
      return true;
    }

    function avancarChamado() {
      const c = chamadoAberto;
      const etapaAtual = c.etapaAtual;
      const etapaInfo = ETAPAS[etapaAtual];
      atenderObs = document.getElementById("atender-obs")?.value.trim() || atenderObs;

      if (!validarAvanco(etapaAtual)) return;
      const prox = proximaEtapa(etapaAtual);
      if (prox === null) return;

      const novaMsg = {
        num: c.mensagens.length + 1,
        etapa: etapaAtual,
        nomeEtapa: etapaInfo.nome,
        usuario: usuarioAtual.nome,
        categoria: usuarioAtual.categorias.find(ct => ct === etapaInfo.responsavel) || usuarioAtual.categorias[0],
        data: dataAgora(),
        texto: atenderObs,
        anexo: atenderAnexo,
        ...(etapaAtual === 4 ? { temMaterial: atenderMaterial } : {}),
        ...(etapaAtual === "5.3" ? { aprovado: atenderAprovacao } : {}),
        ...(etapaAtual === 9 ? { avaliacao: atenderAvaliacao } : {}),
      };

      const atualizado = {
        ...c,
        mensagens: [...c.mensagens, novaMsg],
        etapaAtual: prox === "encerrar" ? 9 : prox,
        status: prox === "encerrar" ? "encerrado" : "aberto",
        avaliacao: prox === "encerrar" ? atenderAvaliacao : c.avaliacao,
      };

      chamados = chamados.map(ch => ch.id === atualizado.id ? atualizado : ch);
      chamadoAberto = atualizado;
      modoAtender = false;
      atenderObs = "";
      atenderAnexo = null;
      atenderMaterial = null;
      atenderAprovacao = null;
      atenderAvaliacao = 0;

      let notifMsg;
      if (prox === "encerrar") notifMsg = "Chamado encerrado com sucesso!";
      else if (etapaAtual === "5.3" && !atenderAprovacao) notifMsg = "Or√ßamento reprovado ‚Äî retornando √† Cota√ß√£o (5.1)";
      else notifMsg = `Chamado avan√ßado para Etapa ${prox}`;
      mostrarNotif(notifMsg);
      renderChamado();
    }

    function renderHistorico() {
      const c = chamadoAberto;
      const enc = c.status === "encerrado";
      const wrap = document.getElementById("chamado-historico");

      const msgs = c.mensagens.map(msg => {
        const cor = CORES[msg.categoria] || { tag: "#333", text: "#ccc", dot: "#888" };
        const materialInfo = msg.temMaterial !== undefined
          ? `<div style="margin-top:8px;font-size:13px;color:${msg.temMaterial ? "#4caf50" : "#ef5350"}">
           ${msg.temMaterial ? "‚úì Material dispon√≠vel em estoque" : "‚úó Material indispon√≠vel ‚Äî encaminhado para compras"}
         </div>` : "";
        const aprovadoInfo = msg.aprovado !== undefined
          ? `<div style="margin-top:8px;font-size:13px;color:${msg.aprovado ? "#4caf50" : "#ef5350"}">
           ${msg.aprovado ? "‚úì Or√ßamento aprovado pelo Gestor" : "‚úó Or√ßamento reprovado ‚Äî retornou √† Cota√ß√£o (5.1)"}
         </div>` : "";
        const avalInfo = msg.avaliacao
          ? `<div style="margin-top:8px;color:#ffa726;font-size:16px">${estrelas(msg.avaliacao)}</div>` : "";
        const devolucaoInfo = msg.devolucao
          ? `<div style="margin-top:8px;padding:8px 12px;background:#2a1a1a;border:1px solid #ef535044;border-radius:8px;font-size:13px">
           <span style="color:#cf7f7f;font-weight:700">‚Ü© Devolu√ß√£o</span>
           <span style="color:#888"> ‚Äî Motivo: </span><span style="color:#e0a0a0">${msg.devolucao.motivo}</span>
           <div style="color:#666;margin-top:2px;font-size:12px">Devolvido para Etapa ${msg.devolucao.para} ‚Äî ${msg.devolucao.nomeEtapa}</div>
         </div>` : "";
        const anexoInfo = msg.anexo
          ? `<div class="msg-anexo">üìé ${msg.anexo.nome}</div>` : "";

        return `
      <div class="msg-card" style="border-left-color:${cor.dot}">
        <div class="msg-header">
          <div class="msg-num">Mensagem ${msg.num}</div>
          <span class="tag-cat" style="background:${cor.tag};color:${cor.text}">${msg.categoria}</span>
        </div>
        <div class="msg-etapa">Etapa ${msg.etapa} ‚Äî ${msg.nomeEtapa}</div>
        <div class="msg-meta">
          <span>üë§ ${msg.usuario}</span>
          <span>üïê ${msg.data}</span>
        </div>
        <div class="msg-texto">${msg.texto}</div>
        ${materialInfo}${aprovadoInfo}${avalInfo}${devolucaoInfo}${anexoInfo}
      </div>`;
      }).join("");

      const avaliacaoFinal = (enc && c.avaliacao)
        ? `<div class="avaliacao-final">
         <div style="font-size:13px;color:#888;margin-bottom:4px">Avalia√ß√£o do solicitante</div>
         <div style="font-size:26px;color:#ffa726">${estrelas(c.avaliacao)}</div>
       </div>` : "";

      wrap.innerHTML = msgs + avaliacaoFinal;
    }

    // ‚îÄ‚îÄ VOLTAR ETAPA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    const MOTIVOS_VOLTAR = {
      1: null, // primeira etapa, n√£o pode voltar
      2: 1,
      3: 2,
      4: 3,
      "5.1": 4,
      "5.2": "5.1",
      "5.3": "5.2",
      "5.4": "5.3",
      6: "5.4",
      7: 6,
      8: 7,
      9: 8,
    };

    function abrirModalVoltar() {
      const c = chamadoAberto;
      const etapaAtual = c.etapaAtual;
      const anterior = MOTIVOS_VOLTAR[etapaAtual];
      if (!anterior) return;
      const sub = document.getElementById("modal-voltar-sub");
      sub.innerHTML = `Etapa atual: <strong style="color:#9fa8da">Etapa ${etapaAtual} ‚Äî ${ETAPAS[etapaAtual].nome}</strong><br>
    Ser√° devolvida para: <strong style="color:#cf7f7f">Etapa ${anterior} ‚Äî ${ETAPAS[anterior].nome}</strong>`;
      document.getElementById("modal-motivo-select").value = "";
      document.getElementById("modal-obs").value = "";
      document.getElementById("modal-voltar").style.display = "block";
    }

    function fecharModalVoltar(event) {
      if (event && event.target !== document.querySelector("#modal-voltar .modal-overlay")) return;
      document.getElementById("modal-voltar").style.display = "none";
    }

    function syncMotivoSelect() {
      const sel = document.getElementById("modal-motivo-select").value;
      const obs = document.getElementById("modal-obs");
      if (sel && sel !== "Outro" && !obs.value) obs.placeholder = sel;
    }

    function confirmarVoltarEtapa() {
      const motivo = document.getElementById("modal-motivo-select").value;
      const obs = document.getElementById("modal-obs").value.trim();
      if (!motivo) { mostrarNotif("Selecione um motivo de devolu√ß√£o.", "erro"); return; }
      if (!obs) { mostrarNotif("O campo de observa√ß√£o √© obrigat√≥rio.", "erro"); return; }

      const c = chamadoAberto;
      const etapaAtual = c.etapaAtual;
      const anterior = MOTIVOS_VOLTAR[etapaAtual];
      const etapaInfo = ETAPAS[etapaAtual];

      const novaMsg = {
        num: c.mensagens.length + 1,
        etapa: etapaAtual,
        nomeEtapa: etapaInfo.nome,
        usuario: usuarioAtual.nome,
        categoria: usuarioAtual.categorias.find(ct => ct === etapaInfo.responsavel) || usuarioAtual.categorias[0],
        data: dataAgora(),
        texto: obs,
        anexo: null,
        devolucao: { motivo, para: anterior, nomeEtapa: ETAPAS[anterior].nome },
      };

      const atualizado = { ...c, mensagens: [...c.mensagens, novaMsg], etapaAtual: anterior };
      chamados = chamados.map(ch => ch.id === atualizado.id ? atualizado : ch);
      chamadoAberto = atualizado;

      document.getElementById("modal-voltar").style.display = "none";
      modoAtender = false;
      mostrarNotif(`Chamado devolvido para Etapa ${anterior} ‚Äî ${ETAPAS[anterior].nome}`);
      renderChamado();
    }

    // ‚îÄ‚îÄ SIMULADOR ANEXO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    function renderAnexo(containerId, valor, onChange) {
      const wrap = document.getElementById(containerId);
      if (!wrap) return;
      if (!valor) {
        wrap.innerHTML = `<button class="btn-anexo" onclick="simularUpload('${containerId}')">üìé Simular Upload de Arquivo</button>`;
        wrap._onChange = onChange;
      } else {
        wrap.innerHTML = `
      <div class="anexo-ativo">
        <span>üìé ${valor.nome}</span>
        <button class="btn-remover-anexo" onclick="removerAnexo('${containerId}')">‚úï</button>
      </div>`;
        wrap._onChange = onChange;
      }
    }

    function simularUpload(containerId) {
      const nome = NOMES_ANEXO[Math.floor(Math.random() * NOMES_ANEXO.length)];
      const wrap = document.getElementById(containerId);
      const cb = wrap._onChange;
      cb({ nome });
      renderAnexo(containerId, { nome }, cb);

      if (containerId === "novo-anexo-wrap") novoAnexo = { nome };
      if (containerId === "atender-anexo-wrap") {
        atenderAnexo = { nome };
        renderFormAtender();
      }
    }

    function removerAnexo(containerId) {
      const wrap = document.getElementById(containerId);
      const cb = wrap._onChange;
      cb(null);

      if (containerId === "novo-anexo-wrap") novoAnexo = null;
      if (containerId === "atender-anexo-wrap") {
        atenderAnexo = null;
        renderFormAtender();
      }
      renderAnexo(containerId, null, cb);
    }

    // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    renderLogin();
  </script>
</body>

</html>